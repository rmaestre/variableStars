---
title: "Patterns Experiment"
author: "Roberto Maestre"
date: "10/24/2018"
output: github_document
---

```{r setup, include=FALSE}
library(variableStars)
library(data.table)
library(ggplot2)
library(ggsci)
library(microbenchmark)
library(RColorBrewer)
library(mgcv)
```


# Introduction

This results can be calculated through the experimental UI available [here](https://github.com/rmaestre/variableStars/tree/master/inst/shiny-examples/experiment).


# Experiment structure

```{r, echo=F}
find_peaks <- function(x) {
  # Diff series
  xd <- diff(x)
  # DS to save peaks
  peaks <- c()
  last_sign <- sign(xd[1])
  # Loop over diff values
  for (i in seq(1:length(xd))) {
    if (last_sign != sign(xd[i]) && sign(xd[i]) < 0) {
      peaks <- c(peaks, i)
    }
    last_sign = sign(xd[i])
  }
  peaks # return peaks index
}
```


```{r}
dt <- generate_data(
  numFreqs = 40,
  distance = 1.1,
  periodF = 0.4,
  periodS = 5.1,
  baseAMplitudeFirst = 10,
  baseAMplitudeSecond = 10,
  seed = 1234,
  freqOneRandRange = 0.0,
  freqTwoRandRange = 0.0,
  ampRandRange = 0.0
  )
```

```{r}
result <- process(
  frequency = dt$x,
  amplitude = dt$y,
  filter = "uniform",
  gRegimen = 0,
  maxDnu = 15,
  minDnu = 15,
  numFrequencies = 30,
  dnuGuessError = -1,
  debug = T
  )
```

```{r}
plot_periodicities(prepare_periodicities_dataset(result$fresAmps))
```

```{r}
plot_histogram(data.frame(result$diffHistogram$histogram))
```

```{r}
ind <- which.max(result$diffHistogram$histogram$values)
periodicity <- result$diffHistogram$histogram$bins[ind]
periodicity + periodicity + periodicity + periodicity + periodicity


```


```{r}
plot_crosscorrelation(data.frame(result$crossCorrelation))
```
